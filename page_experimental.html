<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script>
      
      async function getToken(code) {
        return fetch(`https://teste-next-js-weld.vercel.app/api/get_auth_token`, {
          method: "POST",
          body: JSON.stringify({
            'code_id' : code
          })
        }) .then(response => response)
        .then(data => {
          return data;
        })
      }
      
      async function caller() {
         const queryString = window.location.search;
         if (queryString.includes('?code=')) {
           const urlParams   = new URLSearchParams(queryString);
           const token       = await getToken(urlParams.get('code'));
           document.write(token);
         else {
           // check cookie
         }
      }
        
      caller();

    </script>
  </head>
  <body>
    <header></header>
    <main></main>
    <footer></footer>
  </body>
</html>
